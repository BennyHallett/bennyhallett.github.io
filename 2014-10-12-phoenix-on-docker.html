<!DOCTYPE html>
<html>
  <head>
    <title>Benny Hallett | thoughts on software engineering</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="assets/css/0reset.css" />
<link rel="stylesheet" href="assets/css/1skeleton.css" />
<link rel="stylesheet" href="assets/css/style.css" />
<link rel="stylesheet" href="assets/css/syntax.css" />
    <link rel="stylesheet" href="assets/css/font-awesome/css/font-awesome.min.css" />
    <link href="http://fonts.googleapis.com/css?family=Raleway" rel='stylesheet' type='text/css' />
    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-9971151-1', 'bennyhallett.com');
        ga('send', 'pageview');
      </script>
  </head>

  <body>
    <div class="container">
      <div class="row header">
        <div class="six columns alpha">
          <h1><a href="/">Benny Hallett</a></h1>
          <h2>thoughts on software engineering</h2>
        </div>
        <div class="six columns omega">
          <ul class="nav">
            <li><a href="/projects.html">Projects</a></li>
            <li><a href="/contributions.html">Contributions</a></li>
            <li><a href="/about.html">About</a></li>
          </ul>
        </div>
      </div>

      <div class="row main">
        <div class="nine columns alpha">
          <div id="post">
  <h3 class="post-title"><a href="2014-10-12-phoenix-on-docker.html">Phoenix on Docker</a></h3>
  <p>Today I started playing around with <a href="http://docker.com">Docker</a>, and I have to say that I’m pretty impressed.</p>
<p>Docker is a tool for packaging an application and it’s dependencies into a container, which can then be deployed, without changes, to any host that supports containers.</p>
<p>Since I’ve been doing a lot of <a href="http://elixir-lang.org">Elixir</a> lately, I wanted to try and get a <a href="https://github.com/phoenixframework/phoenix">Phoenix</a> application up and running in a container. In the end it wasn’t too difficult</p>
<h2>The Dockerfile</h2>
<p>The <a href="https://gist.github.com/BennyHallett/81ac88a788607ad876e4">Dockerfile</a> for our Phoenix app looks like this:</p>
<pre><code>FROM        trenpixster/elixir:1.0.1
COPY        . /phoenix_app
ENV         MIX_ENV prod
WORKDIR     /phoenix_app
RUN         mix do deps.get, compile
EXPOSE      4000
CMD         [&quot;mix&quot;, &quot;phoenix.start&quot;]</code></pre>
<p>This <code class="inline">Dockerfile</code> should be placed into the root directory of your Phoenix app. The instructions in the file set up our container.</p>
<p>The <code class="inline">FROM</code> instruction lets Docker know which image it should use as our container’s base. In this instance, we’re going to use <code class="inline">v1.0.1</code> of <a href="https://registry.hub.docker.com/u/trenpixster/elixir/">trenpixster/elixir</a>, which <a href="https://github.com/trenpixster/elixir-dockerfile/blob/master/Dockerfile">already has the Erlang VM and Elixir 1.0.1</a> installed on it. </p>
<p>The <code class="inline">COPY</code> instruction copies our app into the container, to the <code class="inline">/phoenix_app</code> directory. You can rename this to the actual name of your app if you want, but it will work as it is now. If you do change it though, be sure to change the <code class="inline">WORKDIR</code> line as well.</p>
<p>We use <code class="inline">ENV</code> to set the <code class="inline">MIX_ENV</code> environment variable and tell mix that we want to run in the production environment.</p>
<p><code class="inline">WORKDIR</code> ensures that every instruction we run for here on in is launched from <code class="inline">/phoenix_app</code></p>
<p>We then use <code class="inline">RUN</code> to call out to mix and download our dependencies, then compile the app.</p>
<p>The <code class="inline">EXPOSE</code> instruction tells the container to listen on port 4000, the same port that Phoenix runs on.</p>
<p>Finally, we call <code class="inline">CMD</code>, which is the instruction used to start our app. We use mix to run the <code class="inline">phoenix.start</code> task, and we’re up and running.</p>
<h2>Building the image</h2>
<p>Now that we have our specification for our container, we can build it by running:</p>
<pre><code>$ sudo docker build -t &lt;your_username&gt;/&lt;app_name&gt;</code></pre>
<h2>Kicking off our container</h2>
<p>We need to run our image with a couple of switches. <code class="inline">-d</code> will force docker to detach, and run in the background. <code class="inline">-p</code> will redirect one of our system’s ports to the <code class="inline">4000</code> port of the container, allowing us to point our browser at the app running in the container.</p>
<pre><code>$ sudo docker run -p 8088:4000 -d &lt;your_username&gt;/&lt;app_name&gt;</code></pre>
<p>Now you can point your browser at <code class="inline">http://localhost:8088</code> and you should see the app running inside the container.</p>
<h2>Stopping the container</h2>
<p>Since the container is running detached, we need to get docker to stop it for us.</p>
<p>If you run</p>
<pre><code>$ sudo docker ps</code></pre>
<p>you will see the currently running containers, and their ids. Given the container id, you can stop it with</p>
<pre><code>$ sudo docker stop &lt;container_id&gt;</code></pre>

</div>

        </div>
        <div class="three columns omega">
          <div class="centered">
            <img src="assets/img/profile.jpeg" alt="Benny Hallett" class="profile" />
          </div>
          <div class="sidebar-item">
            <ul class="side-nav">
              <p>
                <em>Hey there, I'm Benny Hallett</em> I'm a software engineer from the Central Coast of NSW, Australia.
              </p>

              <p class="find-me centered">
                <a href="http://twitter.com/bennyhallett" target="_"><i class="fa fa-twitter fa-2x"></i></a>
                <a href="http://github.com/bennyhallett" target="_"><i class="fa fa-github fa-2x"></i></a>
                <a href="http://stackoverflow.com/users/109246/benny" target="_"><i class="fa fa-stack-overflow fa-2x"></i></a>
              </p>

              <p>
              I like to write software in both <a href="http://ruby-lang.org">Ruby</a> and <a href="http://elixir-lang.org">Elixir</a> and sometimes publish articles about that.
              </p>
              <p>
                Recently I've become more interested in the human aspects of software engineering, and will be exploring that more often.
              </p>
              <p>
                Want to <a href="about.html">know more?</a>
              </p>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="row footer">
      <div class="container">
        <div class="four columns alpha">
          <h5>site</h5>
          <ul>
            <li><a href="/">blog</a></li>
            <li><a href="/projects.html">projects</a></li>
            <li><a href="/contributions.html">contributions</a></li>
            <li><a href="/about.html">about</a></li>
          </ul>
        </div>
      </div>
    </div>
  </body>
</html>
