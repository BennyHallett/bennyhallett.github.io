<!DOCTYPE html>
<html>
  <head>
    <title>Benny Hallett | thoughts on software engineering</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="assets/css/0reset.css" />
<link rel="stylesheet" href="assets/css/1skeleton.css" />
<link rel="stylesheet" href="assets/css/style.css" />
<link rel="stylesheet" href="assets/css/syntax.css" />
    <link rel="stylesheet" href="assets/css/font-awesome/css/font-awesome.min.css" />
    <link href="http://fonts.googleapis.com/css?family=Raleway" rel='stylesheet' type='text/css' />
    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-9971151-1', 'bennyhallett.com');
        ga('send', 'pageview');
      </script>
  </head>

  <body>
    <div class="container">
      <div class="row header">
        <div class="six columns alpha">
          <h1><a href="/">Benny Hallett</a></h1>
          <h2>thoughts on software engineering</h2>
        </div>
        <div class="six columns omega">
          <ul class="nav">
            <li><a href="/projects.html">Projects</a></li>
            <li><a href="/contributions.html">Contributions</a></li>
            <li><a href="/about.html">About</a></li>
          </ul>
        </div>
      </div>

      <div class="row main">
        <div class="nine columns alpha">
          <div id="post">
  <h3 class="post-title"><a href="2015-05-06-elixir-command-line-app-with-anubis.html">Creating a command line app in Elixir with Anubis, Part one.</a></h3>
  <p><a href="https://github.com/BennyHallett/anubis">Anubis</a> is a simple command line
application library for Elixir. Today we’ll be looking at how to create a simple
application using Anubis, making use of all of it’s features.</p>
<p>The application that we’ll be building is the slightly overused TODO list
example. We’ll be creating a command line application to manage one or more of
these lists.</p>
<p>This is part one of the tutorial, in which we will create our TODO library.</p>
<p>Let’s get started.</p>
<h3>Creating the shell of our application</h3>
<p>Fire up your favourite shell and follow type in the commands below. (I’m using
bash in Ubuntu. Other shell / distro combinations shouldn’t make any difference, but
<a href="http://twitter.com/bennyhallett">please let me know</a> if they do).</p>
<p>Firstly we want to create our Elixir project. We can do that by using mix:</p>
<pre><code>$ mix new extodo --module ExTodo
$ cd extodo</code></pre>
<p>Our next step is to add Anubis as a dependency and install it. Anubis should be
the only dependency that we need.</p>
<p>Add the following to your mix.exs file:</p>
<pre><code>deps: [{:anubis, &quot;~&gt; 0.3.0&quot;}]</code></pre>
<p>And then get mix to download the project’s dependencies and compile them:</p>
<pre><code>$ mix do deps.get, compile</code></pre>
<h3>A TodoList library</h3>
<p>The aim for this article will be to build our TodoList library. We won’t be
making use of Anubis today, but we’ll be in a good place to hook everything
together in the next article.</p>
<p>On the face of it, our TodoList is just a list for us to put things into and
take them back out of. We could simply use the <code class="inline">List</code> module functions and be
done with it, but let’s try to model our TodoList, along with a suite of tests,
as an exercise.</p>
<p>First thing’s first, we want to be able to create a new todo list. Lets start
by writing a test. Create a new test file at `./test/todo_list_test.exs’, and
let’s begin:</p>
<pre><code>defmodule TodoListTest do
  use ExUnit.Case

  test &quot;create a new todo list&quot; do
    assert [] == ExTodo.TodoList.create
  end

end</code></pre>
<p>We can run that test and see that it fails, because we haven’t yet created
our<code class="inline">ExTodo.TodoList</code> module. Lets change that.</p>
<p>Create a file at <code class="inline">./lib/extodo/todo_list.ex</code> and create the <code class="inline">ExTodo.TodoList</code>
module. Lets implement the <code class="inline">create</code> function:</p>
<pre><code>defmodule ExTodo.TodoList do
  def create, do: []
end</code></pre>
<p>That’s a very simple implementation, and as we mentioned earlier, it’s just a
list.</p>
<p>Our test passes now, so next lets try to add an entry to the list. We start again by writing another
test.</p>
<pre><code>test &quot;add an item to the list&quot; do
  list = ExTodo.TodoList.create

  one = ExTodo.TodoList.add(list, &quot;ONE&quot;)
  two = ExTodo.TodoList.add(one, &quot;TWO&quot;)

  assert [&quot;ONE&quot;] == one
  assert [&quot;TWO&quot;, &quot;ONE&quot;] == two
end</code></pre>
<p>Given Elixir’s immutable data types, we expect to end up with two lists here
rather than one.</p>
<p>Go back into our TodoList implementation and add the <code class="inline">add</code> function. Lets use
the <code class="inline">[head|tail]</code> operator to implement this:</p>
<pre><code>def add(todo, item), do: [item|todo]</code></pre>
<p>Run the tests again to confirm that we’ve achieved our goal.</p>
<p>This works great but we have one limitation. What happens if we add the same
item twice? We want to ensure that each element only appears in our list once,
so lets write a test exposing this limitation.</p>
<pre><code>test &quot;add one item to the list twice&quot; do
  list = ExTodo.TodoList.create
  |&gt; ExTodo.TodoList.add(&quot;Same&quot;)
  |&gt; ExTodo.TodoList.add(&quot;Same&quot;)

  assert [&quot;Same&quot;] == list
end</code></pre>
<p>Our test exposes our flaw, and we get <code class="inline">[&quot;Same&quot;, &quot;Same&quot;]</code> rather than our expected
<code class="inline">[&quot;Same&quot;]</code>. The <code class="inline">Enum</code> module has a handy built in function we can use to ensure
our list is unique. Modify our existing <code class="inline">add</code> function by passing our newly
modified list through <code class="inline">Enum.uniq</code>:</p>
<pre><code>def add(todo, item), do: [item|todo] |&gt; Enum.uniq</code></pre>
<p>Next we should do the opposite and allow ourselves to remove items from the
list.</p>
<pre><code>test &quot;remove an item from the list&quot; do
  list = ExTodo.TodoList.create
  |&gt; ExTodo.TodoList.add(&quot;AAA&quot;)
  |&gt; ExTodo.TodoList.add(&quot;BBB&quot;)
  |&gt; ExTodo.TodoList.add(&quot;CCC&quot;)

  assert [&quot;CCC&quot;, &quot;AAA&quot;] == ExTodo.TodoList.remove(&quot;BBB&quot;)
end</code></pre>
<p>We could easily use the built in function <code class="inline">List.delete</code> to remove the item, but
lets explore functional programming a little more and use <a href="http://stackoverflow.com/a/37010/109246">tail
recursion</a> instead.</p>
<pre><code>def remove(todo, item), do: _remove(todo, item, [])

defp _remove([], item, output), do: output |&gt; Enum.reverse
defp _remove([item|tail], item, output), do: _remove(tail, item, output)
defp _remove([head|tail], item, output), do: _remove(tail, item, [head|output])</code></pre>
<p>As we see here, our <code class="inline">remove</code> function simply delegates to the private <code class="inline">_remove</code>
function, passing in an empty output list. Here we use a combination of tail
recursion and <a href="http://elixir-lang.org/getting-started/pattern-matching.html">pattern matching</a>
to achieve our goal.</p>
<p>Let’s go over the 3 function heads individually:</p>
<ul>
<li>The first is our terminating clause. When our input list has been exhausted,
  we can return the output list. Note that we reverse the list, which is
commonly required when using tail recursion to process a list.
</li>
<li>The second function head is invoked when the head of our input list is the same
  as the item we’re looking to remove. In this case, we continue our processing
without including the item in the output list.
</li>
<li>The final one is invoked in most cases, when the head of the input list is not
  the item we’re looking to remove. We add the item to the output list and
continue on.
</li>
</ul>
<p>Run the tests again and see that they all pass. No we’re getting somewhere!</p>
<h3>Persistence</h3>
<p>We’ve got ourselves a nice model for out Todo List but we’re missing something:
<em>Persistence</em></p>
<p>Before we get started, it’s worth talking about the format of our file. We need
to agree on a simple format to store our todo list as, and the simplest one I
can think of is a text based file, with each item in the todo list on a new
line.</p>
<p>Once again, we should start by writing a test. Lets create a new test file, to
contain our tests regarding persistence, and then add our first test.</p>
<pre><code>defmodule PersistenceTest do
  use ExUnit.Case

  @filename &#39;/tmp/todolist&#39;

  setup do
    on_exit fn -&gt; @filename |&gt; File.rm end
  end

  test &quot;save a todo list&quot; do
    list = ExTodo.TodoList.create
    |&gt; ExTodo.TodoList.add(&quot;first&quot;)
    |&gt; ExTodo.TodoList.add(&quot;second&quot;)
    |&gt; ExTodo.TodoList.add(&quot;third&quot;)
    |&gt; ExTodo.TodoList.save(@filename)

    contents = File.read!(@filename)

    assert &quot;third\nsecond\nfirst&quot; == contents
  end

end</code></pre>
<p>In this test module we’ve created a setup task that will delete our temporary
todo list after it’s created. If you’re on Windows, you will need to change the
location of the file in <em>@filename</em></p>
<p>Our test simply creates a new Todo List, saves it, and asserts that the contents
of the file are as we expect.</p>
<p>With that test failing, lets save our list.</p>
<p>Create a new save function in the ExTodo.TodoList module, that looks like:</p>
<pre><code>def save(list, filename), do: File.write(filename, Enum.join(list, &quot;\n&quot;))</code></pre>
<p>We simply convert the list into a newline separated string, and write that out
to the given filename.</p>
<p>The last item required for our TodoList module is loading the file again.
We’ve almost already done this in our test, so this one should be fairly straight
forward.</p>
<p>Lets add our test</p>
<pre><code>test &quot;load a todo list&quot; do
  File.write(@filename, &quot;third\nsecond\nfirst&quot;)

  list = ExTodo.TodoList.load(@filename)

  assert [&quot;third&quot;, &quot;second&quot;, &quot;first&quot;] == list
end</code></pre>
<p>We can implement it by reading in the filename and splitting the string on
the newline character. We must be careful to include the trim option, so that we
don’t get empty items if the file ends in a newline</p>
<pre><code>def load(filename), do: filename |&gt; File.read! |&gt; String.split(&quot;\n&quot;, trim: true)</code></pre>
<h2>That's all for part one</h2>
<p>That’s all we’ve got time for in part one of this exercise. We’ve built
ourselves a simple TodoList module that allows us to create, modify, save and
load our todo lists.</p>
<p>In the next installment we’ll finish off the application, learning how to use
<a href="https://github.com/BennyHallett/anubis">Anubis</a> to build a command line
interface to interact with our Todo Lists.</p>
<p>We’ll look at building a command line app with multiple commands, using a
runtime configuration file to automatically tell us where to load and save our
todo lists, and look at command line switches to change that at runtime.</p>

</div>

        </div>
        <div class="three columns omega">
          <div class="centered">
            <img src="assets/img/profile.jpeg" alt="Benny Hallett" class="profile" />
          </div>
          <div class="sidebar-item">
            <ul class="side-nav">
              <p>
                <em>Hey there, I'm Benny Hallett</em> I'm a software engineer from the Central Coast of NSW, Australia.
              </p>

              <p class="find-me centered">
                <a href="http://twitter.com/bennyhallett" target="_"><i class="fa fa-twitter fa-2x"></i></a>
                <a href="http://github.com/bennyhallett" target="_"><i class="fa fa-github fa-2x"></i></a>
                <a href="http://stackoverflow.com/users/109246/benny" target="_"><i class="fa fa-stack-overflow fa-2x"></i></a>
              </p>

              <p>
              I like to write software in both <a href="http://ruby-lang.org">Ruby</a> and <a href="http://elixir-lang.org">Elixir</a> and sometimes publish articles about that.
              </p>
              <p>
                Recently I've become more interested in the human aspects of software engineering, and will be exploring that more often.
              </p>
              <p>
                Want to <a href="about.html">know more?</a>
              </p>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="row footer">
      <div class="container">
        <div class="three columns alpha">
          <h5>site</h5>
          <ul>
            <li><a href="/">blog</a></li>
            <li><a href="/projects.html">projects</a></li>
            <li><a href="/contributions.html">contributions</a></li>
            <li><a href="/about.html">about</a></li>
          </ul>
        </div>
        <div class="three columns">
        <h5>projects</h5>
          <ul>
            <li><a href="http://github.com/bennyhallett/obelisk">obelisk</a></li>
            <li><a href="http://github.com/bennyhallett/anubis">anubis</a></li>
          </ul>
        </div>
      </div>
    </div>
  </body>
</html>
